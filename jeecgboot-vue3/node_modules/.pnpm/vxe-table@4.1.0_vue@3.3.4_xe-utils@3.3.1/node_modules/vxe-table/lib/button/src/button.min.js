"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _vue=require("vue"),_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../v-x-e-table/src/conf")),_size=require("../../hooks/size"),_dom=require("../../tools/dom"),_utils=require("../../tools/utils"),_event=require("../../tools/event");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default2=(0,_vue.defineComponent)({name:"VxeButton",props:{type:String,className:String,size:{type:String,default:function(){return _conf.default.button.size||_conf.default.size}},name:[String,Number],content:String,placement:String,status:String,icon:String,round:Boolean,circle:Boolean,disabled:Boolean,loading:Boolean,destroyOnClose:Boolean,transfer:{type:Boolean,default:function(){return _conf.default.button.transfer}}},emits:["click","dropdown-click"],setup:function(m,e){function _(e){u.dispatchEvent("click",{$event:e},e)}function b(e){0===e.button&&e.stopPropagation()}function h(e){var t=e.currentTarget,n=z.value,t=(o=(0,_dom.getEventTargetNode)(e,t,"vxe-button")).flag,o=o.targetElem;t&&(n&&(n.dataset.active="N"),P.showPanel=!1,setTimeout(function(){n&&"Y"===n.dataset.active||(P.animatVisible=!1)},350),u.dispatchEvent("dropdown-click",{name:o.getAttribute("name"),$event:e},e))}function x(){var e=z.value;e&&(e.dataset.active="Y",P.inited||(P.inited=!0),n.showTime=setTimeout(function(){"Y"===e.dataset.active?q():P.animatVisible=!1},250))}function g(){r()}function w(){var e=m.content,t=m.icon,n=[];return m.loading?n.push((0,_vue.h)("i",{class:["vxe-button--loading-icon",_conf.default.icon.BUTTON_LOADING]})):t&&n.push((0,_vue.h)("i",{class:["vxe-button--icon",t]})),T.default?n.push((0,_vue.h)("span",{class:"vxe-button--content"},T.default({}))):e&&n.push((0,_vue.h)("span",{class:"vxe-button--content"},(0,_utils.getFuncText)(e))),n}var T=e.slots,o=e.emit,t=_xeUtils.default.uniqueId(),y=(0,_size.useSize)(m),P=(0,_vue.reactive)({inited:!1,showPanel:!1,animatVisible:!1,panelIndex:0,panelStyle:{},panelPlacement:""}),n={showTime:null},N=(0,_vue.ref)(),k=(0,_vue.ref)(),z=(0,_vue.ref)(),i={refElem:N},a={xID:t,props:m,context:e,reactData:P,internalData:n,getRefMaps:function(){return i}},u={},O=(0,_vue.computed)(function(){var e=m.type;return!!e&&-1<["submit","reset","button"].indexOf(e)}),S=(0,_vue.computed)(function(){var e=m.type;return e&&"text"===e?e:"button"}),s=function(){P.panelIndex<(0,_utils.getLastZIndex)()&&(P.panelIndex=(0,_utils.nextZIndex)())},l=function(){return(0,_vue.nextTick)().then(function(){var e=m.transfer,t=m.placement,n=P.panelIndex,o=k.value,i=z.value;if(i&&o){var a=o.offsetHeight,u=o.offsetWidth,s=i.offsetHeight,l=i.offsetWidth,r={zIndex:n},c=(0,_dom.getAbsolutePos)(o),d=c.boundingTop,i=c.boundingLeft,n=c.visibleHeight,o=c.visibleWidth,c="bottom";return e?(e=d+a,"top"===t?(c="top",e=d-s):t||(n<e+s+5&&(c="top",e=d-s),e<5&&(c="bottom",e=d+a)),o<(i=i+u-l)+l+5&&(i-=i+l+5-o),i<5&&(i=5),Object.assign(r,{left:i+"px",right:"auto",top:e+"px",minWidth:u+"px"})):"top"===t?(c="top",r.bottom=a+"px"):t||n<d+a+s&&5<d-a-s&&(c="top",r.bottom=a+"px"),P.panelStyle=r,P.panelPlacement=c,(0,_vue.nextTick)()}})},q=function(){var e=z.value;e&&(e.dataset.active="Y",P.animatVisible=!0,setTimeout(function(){"Y"===e.dataset.active&&(P.showPanel=!0,s(),l(),setTimeout(function(){P.showPanel&&l()},50))},20))},r=function(){var e=z.value;clearTimeout(n.showTime),e?(e.dataset.active="N",setTimeout(function(){"Y"!==e.dataset.active&&(P.showPanel=!1,setTimeout(function(){"Y"!==e.dataset.active&&(P.animatVisible=!1)},350))},100)):(P.animatVisible=!1,P.showPanel=!1)},u={dispatchEvent:function(e,t,n){o(e,Object.assign({$button:a,$event:n},t))},focus:function(){return k.value.focus(),(0,_vue.nextTick)()},blur:function(){return k.value.blur(),(0,_vue.nextTick)()}};Object.assign(a,u),(0,_vue.onMounted)(function(){_event.GlobalEvent.on(a,"mousewheel",function(e){var t=z.value;P.showPanel&&!(0,_dom.getEventTargetNode)(e,t).flag&&r()})}),(0,_vue.onUnmounted)(function(){_event.GlobalEvent.off(a,"mousewheel")});return a.renderVN=function(){var e=m.className,t=m.transfer,n=m.type,o=m.round,i=m.circle,a=m.destroyOnClose,u=m.status,s=m.name,l=m.disabled,r=m.loading,c=P.inited,d=P.showPanel,v=O.value,f=S.value,p=y.value;return T.dropdowns?(0,_vue.h)("div",{ref:N,class:["vxe-button--dropdown",e,((e={})["size--"+p]=p,e["is--active"]=d,e)]},[(0,_vue.h)("button",{ref:k,class:["vxe-button","type--"+f,((e={})["size--"+p]=p,e["theme--"+u]=u,e["is--round"]=o,e["is--circle"]=i,e["is--disabled"]=l||r,e["is--loading"]=r,e)],name:s,type:v?n:"button",disabled:l||r,onMouseenter:x,onMouseleave:g,onClick:_},w().concat([(0,_vue.h)("i",{class:"vxe-button--dropdown-arrow "+_conf.default.icon.BUTTON_DROPDOWN})])),(0,_vue.h)(_vue.Teleport,{to:"body",disabled:!t||!c},[(0,_vue.h)("div",{ref:z,class:["vxe-button--dropdown-panel",((t={})["size--"+p]=p,t["animat--leave"]=P.animatVisible,t["animat--enter"]=d,t)],placement:P.panelPlacement,style:P.panelStyle},c?[(0,_vue.h)("div",{class:"vxe-button--dropdown-wrapper",onMousedown:b,onClick:h,onMouseenter:q,onMouseleave:g},a&&!d?[]:T.dropdowns({}))]:[])])]):(0,_vue.h)("button",{ref:k,class:["vxe-button","type--"+f,((f={})["size--"+p]=p,f["theme--"+u]=u,f["is--round"]=o,f["is--circle"]=i,f["is--disabled"]=l||r,f["is--loading"]=r,f)],name:s,type:v?n:"button",disabled:l||r,onClick:_},w())},a},render:function(){return this.renderVN()}});exports.default=_default2;